import{c as B,u as X,j as e,C as F,h as V,M as re,i as be,I as fe,g as je,k as H,X as ve,e as Ne,s as ke}from"./index-DNUMW6e8.js";import{r as p}from"./react-vendor-nf7bT_Uh.js";import{L as T}from"./loader-circle-BxrLM6NC.js";import{T as we}from"./truck-3yKFS4DX.js";import{U as Ce}from"./user-BnBREg4W.js";import{C as Se}from"./circle-x-CCQTRe-L.js";import"./swiper-vendor-y1f9feYf.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=B("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=B("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=B("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=B("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=B("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),Ae=({deliveryMethod:a,selectedBranch:h,branches:x,branchesLoading:t,errors:j,onDeliveryMethodChange:g,onBranchSelect:u})=>{const{t:o,currentLang:r}=X();return e.jsxs("div",{className:"mb-6 space-y-3",children:[j.deliveryMethod&&e.jsxs("div",{className:"p-3 bg-red-50 border-2 border-red-500 rounded-xl text-red-600 text-sm flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:j.deliveryMethod})]}),e.jsxs("div",{className:`flex items-center gap-4 p-4 border-2 rounded-2xl cursor-pointer transition-all ${a==="pickup"?"border-primary bg-primary/10":"border-gray-300 hover:border-primary"}`,onClick:()=>g("pickup"),children:[e.jsx(Le,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold",children:o("pickupOption")||"Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„ÙØ±Ø¹"}),e.jsx("div",{className:"text-sm text-gray-600",children:o("pickupDesc")||"Ù…Ø¬Ø§Ù†Ø§Ù‹ - 15 Ø¯Ù‚ÙŠÙ‚Ø©"})]}),e.jsx(V,{className:`w-6 h-6 ${a==="pickup"?"text-primary":"text-gray-300"}`})]}),a==="pickup"&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-2xl p-5 border-2 border-gray-200 dark:border-gray-600",children:[e.jsxs("label",{className:"flex items-center gap-2 font-bold mb-4 text-gray-800 dark:text-gray-100",children:[e.jsx(re,{className:"w-5 h-5 text-primary"}),e.jsxs("span",{children:[o("selectBranch")||"Ø§Ø®ØªØ± Ø§Ù„ÙØ±Ø¹",":"]})]}),t?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx(T,{className:"w-6 h-6 animate-spin text-primary"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:r==="ar"?"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...":"Loading..."})]}):x.length===0?e.jsx("div",{className:"text-center py-4 text-gray-500",children:r==="ar"?"Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ±ÙˆØ¹ Ù…ØªØ§Ø­Ø©":"No branches available"}):e.jsx("div",{className:"space-y-3",children:x.map(i=>e.jsxs("div",{className:`p-4 border-2 rounded-xl cursor-pointer transition-all ${h===i.id?"border-primary bg-primary/10":"border-gray-300 hover:border-primary"}`,onClick:()=>u(i.id),children:[e.jsx("div",{className:"font-bold text-gray-800 dark:text-gray-100",children:r==="ar"?i.name:i.nameEn}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:r==="ar"?i.address:i.addressEn}),i.phone&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:["ğŸ“ ",i.phone]})]},i.id))}),j.branch&&e.jsxs("div",{className:"text-red-500 text-sm mt-3 flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:j.branch})]})]}),e.jsxs("div",{className:`flex items-center gap-4 p-4 border-2 rounded-2xl cursor-pointer transition-all ${a==="delivery"?"border-primary bg-primary/10":"border-gray-300 hover:border-primary"}`,onClick:()=>g("delivery"),children:[e.jsx(we,{className:"w-6 h-6 text-primary"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold",children:o("deliveryOption")||"Ø§Ù„ØªÙˆØµÙŠÙ„"}),e.jsx("div",{className:"text-sm text-gray-600",children:o("deliveryDesc")||"Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ - 30 Ø¯Ù‚ÙŠÙ‚Ø©"})]}),e.jsx(V,{className:`w-6 h-6 ${a==="delivery"?"text-primary":"text-gray-300"}`})]})]})},$e=({formData:a,deliveryMethod:h,errors:x,userLocation:t,locationLoading:j,locationError:g,couponStatus:u,couponData:o,couponLoading:r,onInputChange:i,onRequestLocation:N,onApplyCoupon:w,onRemoveCoupon:I})=>{const{t:v,currentLang:b}=X();return e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-bold mb-2 text-gray-700 dark:text-gray-300",children:[e.jsx(Ce,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{children:[v("fullName")||"Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"," *"]})]}),e.jsx("input",{type:"text",className:`w-full px-4 py-3 border-2 rounded-xl transition-all ${x.name?"border-red-500 bg-red-50":"border-gray-300 focus:border-primary"}`,placeholder:v("enterFullName")||"Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ",value:a.name,onChange:y=>i("name",y.target.value)}),x.name&&e.jsxs("div",{className:"text-red-500 text-sm mt-1 flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:x.name})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-bold mb-2 text-gray-700 dark:text-gray-300",children:[e.jsx(be,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{children:[v("phoneNumber")||"Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"," *"]})]}),e.jsx("input",{type:"tel",className:`w-full px-4 py-3 border-2 rounded-xl transition-all ${x.phone?"border-red-500 bg-red-50":"border-gray-300 focus:border-primary"}`,placeholder:"01234567890",dir:"ltr",value:a.phone,onChange:y=>i("phone",y.target.value.replace(/\D/g,"").substring(0,11))}),x.phone&&e.jsxs("div",{className:"text-red-500 text-sm mt-1 flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:x.phone})]})]}),h==="delivery"&&e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-bold mb-2 text-gray-700 dark:text-gray-300",children:[e.jsx(re,{className:"w-4 h-4 text-primary"}),e.jsxs("span",{children:[v("detailedAddress")||"Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙØµÙŠÙ„ÙŠ"," *"]})]}),e.jsxs("button",{type:"button",className:`w-full mb-3 px-4 py-3 border-2 rounded-xl flex items-center justify-center gap-2 font-bold transition-all ${t?"border-green-500 bg-green-50 text-green-700":"border-primary bg-primary/10 text-primary hover:bg-primary/20"}`,onClick:N,disabled:j,children:[j?e.jsx(T,{className:"w-5 h-5 animate-spin"}):t?e.jsx(V,{className:"w-5 h-5"}):e.jsx(Ie,{className:"w-5 h-5"}),e.jsx("span",{children:j?b==="ar"?"Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ¯...":"Getting location...":t?b==="ar"?"ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ âœ“":"Location Set âœ“":b==="ar"?"Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ":"Use Current Location"})]}),g&&e.jsxs("div",{className:"mb-3 p-3 bg-red-50 border-2 border-red-500 rounded-xl text-red-600 text-sm flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:g})]}),e.jsx("textarea",{className:`w-full px-4 py-3 border-2 rounded-xl min-h-[80px] transition-all ${x.address?"border-red-500 bg-red-50":"border-gray-300 focus:border-primary"}`,placeholder:v("addressPlaceholder")||"Ø§Ù„Ø´Ø§Ø±Ø¹ØŒ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©...",value:a.address,onChange:y=>i("address",y.target.value)}),x.address&&e.jsxs("div",{className:"text-red-500 text-sm mt-1 flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:x.address})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-bold mb-2 text-gray-700 dark:text-gray-300",children:[e.jsx(Fe,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:v("additionalNotes")||"Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©"})]}),e.jsx("textarea",{className:"w-full px-4 py-3 border-2 border-gray-300 rounded-xl min-h-[60px] focus:border-primary transition-all",placeholder:v("notesPlaceholder")||"Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª Ø®Ø§ØµØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",value:a.notes,onChange:y=>i("notes",y.target.value.substring(0,300))}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 text-right",children:[a.notes.length,"/300"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-bold mb-2 text-gray-700 dark:text-gray-300",children:[e.jsx(Me,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:v("couponCode")||"ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",className:"flex-1 px-4 py-3 border-2 border-gray-300 rounded-xl uppercase focus:border-primary transition-all disabled:bg-gray-100",placeholder:b==="ar"?"Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯":"Enter code",value:a.couponCode,onChange:y=>i("couponCode",y.target.value.toUpperCase()),disabled:u==="valid"}),u!=="valid"?e.jsx("button",{type:"button",className:"px-6 py-3 bg-gradient-to-r from-primary to-primary-dark text-white rounded-xl font-bold hover:shadow-lg transition-all disabled:opacity-50",onClick:w,disabled:r||!a.couponCode.trim(),children:r?e.jsx(T,{className:"w-5 h-5 animate-spin"}):b==="ar"?"ØªØ·Ø¨ÙŠÙ‚":"Apply"}):e.jsx("button",{type:"button",className:"px-6 py-3 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600 transition-all",onClick:I,children:e.jsx(Se,{className:"w-5 h-5"})})]}),u==="valid"&&o&&e.jsxs("div",{className:"mt-2 p-3 bg-green-50 border-2 border-green-500 rounded-xl text-green-700 text-sm flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),e.jsx("span",{className:"font-bold",children:o.messageAr||o.message||(b==="ar"?"ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ† Ø¨Ù†Ø¬Ø§Ø­":"Coupon applied successfully")})]}),u==="error"&&(o==null?void 0:o.error)&&e.jsxs("div",{className:"mt-2 p-3 bg-red-50 border-2 border-red-500 rounded-xl text-red-600 text-sm flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:o.error})]})]})]})},qe=({cart:a,products:h,productsLoading:x,prices:t,pricesLoading:j,pricesError:g,deliveryMethod:u})=>{var i,N,w;const{t:o,currentLang:r}=X();return e.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-purple-50 dark:from-gray-700 dark:to-gray-600 rounded-2xl p-5 mb-6 border-2 border-pink-100 dark:border-gray-600 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2.5 text-base font-bold mb-4 pb-3 border-b-2 border-pink-200 dark:border-gray-500",children:[e.jsx(Ee,{className:"w-5 h-5 text-primary"}),e.jsx("span",{className:"text-gray-800 dark:text-gray-100",children:o("orderSummary")||"Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨"})]}),j?e.jsxs("div",{className:"flex items-center justify-center py-6",children:[e.jsx(T,{className:"w-6 h-6 animate-spin text-primary"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:r==="ar"?"Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±...":"Calculating prices..."})]}):g&&!t?e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 border-2 border-red-500 rounded-xl text-red-600 dark:text-red-400 text-sm flex items-center gap-2",children:[e.jsx(F,{className:"w-4 h-4"}),e.jsx("span",{children:g})]}):t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2.5 mb-4",children:a.map((I,v)=>{var C;const b=h[I.productId];if(!b)return null;const y=r==="ar"?b.name:b.nameEn,l=(C=t.items)==null?void 0:C.find(A=>A.productId===I.productId),q=(l==null?void 0:l.price)||b.price,E=(l==null?void 0:l.subtotal)||q*I.quantity;return e.jsxs("div",{className:"flex justify-between items-center text-sm bg-white dark:bg-gray-800 rounded-lg p-3 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:b.image,alt:y,className:"w-10 h-10 rounded-lg object-cover"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-800 dark:text-gray-100",children:y}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[q.toFixed(2)," Ø¬.Ù… Ã— ",I.quantity]})]})]}),e.jsxs("span",{className:"font-bold text-primary",children:[E.toFixed(2)," Ø¬.Ù…"]})]},v)})}),e.jsxs("div",{className:"border-t-2 border-pink-200 dark:border-gray-500 pt-3 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("span",{children:[o("subtotal")||"Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ",":"]}),e.jsxs("span",{className:"font-semibold",children:[t.subtotal.toFixed(2)," Ø¬.Ù…"]})]}),u==="delivery"&&e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:[o("deliveryFee")||"Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„",":"]}),((i=t.deliveryInfo)==null?void 0:i.isEstimated)&&e.jsx("span",{className:"inline-flex items-center bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-400 px-2 py-0.5 rounded-full text-xs font-bold",children:r==="ar"?"ØªÙ‚Ø¯ÙŠØ±ÙŠ":"Est."})]}),e.jsx("span",{className:"font-semibold",children:t.deliveryFee>0?`${t.deliveryFee.toFixed(2)} Ø¬.Ù…`:r==="ar"?"Ù…Ø¬Ø§Ù†ÙŠ":"FREE"})]}),t.discount>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600 dark:text-green-400",children:[e.jsxs("span",{children:[o("discount")||"Ø§Ù„Ø®ØµÙ…",":"]}),e.jsxs("span",{className:"font-semibold",children:["-",t.discount.toFixed(2)," Ø¬.Ù…"]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold text-gray-800 dark:text-gray-100 pt-2 border-t border-pink-200 dark:border-gray-500",children:[e.jsxs("span",{children:[o("total")||"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ",":"]}),e.jsxs("span",{className:"text-primary text-xl",children:[t.total.toFixed(2)," Ø¬.Ù…"]})]})]}),((N=t.deliveryInfo)==null?void 0:N.isEstimated)&&u==="delivery"&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-500 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-500 shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs leading-relaxed",children:[e.jsx("div",{className:"font-bold text-yellow-800 dark:text-yellow-400 mb-1",children:r==="ar"?"Ù…Ù„Ø§Ø­Ø¸Ø© Ù‡Ø§Ù…Ø©":"Important Note"}),e.jsx("div",{className:"text-yellow-700 dark:text-yellow-500",children:((w=t.deliveryInfo.estimatedMessage)==null?void 0:w[r])||(r==="ar"?"Ø±Ø³ÙˆÙ… Ø§Ù„ØªÙˆØµÙŠÙ„ ØªÙ‚Ø¯ÙŠØ±ÙŠØ©. Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„ÙØ¹Ù„ÙŠØ©.":"Delivery fee is estimated. We will contact you to confirm location and calculate actual fee.")})]})]})}),t.isOffline&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border-l-4 border-yellow-500 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-500 shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-xs leading-relaxed",children:[e.jsx("div",{className:"font-bold text-yellow-800 dark:text-yellow-400 mb-1",children:r==="ar"?"âš ï¸ ÙˆØ¶Ø¹ Ø¹Ø¯Ù… Ø§Ù„Ø§ØªØµØ§Ù„":"âš ï¸ Offline Mode"}),e.jsx("div",{className:"text-yellow-700 dark:text-yellow-500",children:r==="ar"?"Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ØªÙ‚Ø¯ÙŠØ±ÙŠØ© - Ø³ÙŠØªÙ… Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ù†Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„":"Prices are estimated - will be confirmed when online"})]})]})})]}):e.jsx("div",{className:"text-center py-6 text-gray-500 text-sm",children:r==="ar"?"Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆØµÙŠÙ„ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±":"Select delivery method to see prices"})]})};function Pe(a){if(!a||typeof a!="string")return!1;const h=a.replace(/\D/g,"");return[/^(010|011|012|015)\d{8}$/,/^20(10|11|12|15)\d{8}$/,/^(\+20|0020)(10|11|12|15)\d{8}$/].some(t=>t.test(h))}function K(a,h=0,x=1/0){if(typeof a!="string")return!1;const t=a.trim().length;return t>=h&&t<=x}function Oe({formData:a,deliveryMethod:h,selectedBranch:x}){const t={};return h||(t.deliveryMethod="Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…"),(!a.name.trim()||!K(a.name,2,50))&&(t.name="Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨ (2-50 Ø­Ø±Ù)"),Pe(a.phone)||(t.phone="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ ØºÙŠØ± ØµØ­ÙŠØ­ (Ù…Ø«Ø§Ù„: 01012345678)"),h==="pickup"&&!x&&(t.branch="Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±Ø¹ Ù„Ù„Ø§Ø³ØªÙ„Ø§Ù…"),h==="delivery"&&(!a.address.trim()||!K(a.address,10,200))&&(t.address="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ù…Ø·Ù„ÙˆØ¨ (10-200 Ø­Ø±Ù)"),a.notes&&!K(a.notes,0,300)&&(t.notes="Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙŠØ¬Ø¨ Ø£Ù„Ø§ ØªØ²ÙŠØ¯ Ø¹Ù† 300 Ø­Ø±Ù"),{valid:Object.keys(t).length===0,errors:t}}const Xe=({isOpen:a,onClose:h,onCheckoutSuccess:x})=>{const{cart:t,clearCart:j}=je(),{t:g,currentLang:u,productsMap:o}=X(),[r,i]=p.useState(null),[N,w]=p.useState(null),[I,v]=p.useState([]),[b,y]=p.useState(!1),[l,q]=p.useState({name:"",phone:"",address:"",notes:"",couponCode:""}),[E,C]=p.useState({}),[A,L]=p.useState(null),[R,$]=p.useState(null),[se,Q]=p.useState(!1),[k,U]=p.useState(null),[le,D]=p.useState(!1),[ne,z]=p.useState(null),[m,G]=p.useState(null),[de,Y]=p.useState(!1),[oe,_]=p.useState(null),[P,ee]=p.useState(!1),[te,W]=p.useState(null);p.useEffect(()=>{a&&t.length>0&&ie()},[a,t]);const ie=async()=>{i(null),w(null),U(null),G(null),L(null),$(null),C({}),W(null),y(!0);try{const s=await H.getBranches();v(s)}catch(s){console.error("Failed to load branches:",s)}finally{y(!1)}};p.useEffect(()=>{if(!a||!r||t.length===0)return;const d=setTimeout(async()=>{console.log("ğŸ”„ Recalculating prices..."),Y(!0),_(null);try{const c=await H.calculateOrderPrices(t.map(n=>({productId:n.productId||n.id,quantity:n.quantity})),A==="valid"&&l.couponCode?l.couponCode.trim():null,r,l.phone.replace(/\D/g,"")||null,k,Z());G(c),console.log("âœ… Prices calculated:",c)}catch(c){console.error("âŒ Price calculation failed:",c),_(c.message);const n=ae();G(n)}finally{Y(!1)}},300);return()=>clearTimeout(d)},[a,r,N,k,A]);const Z=()=>r!=="delivery"?null:k!=null&&k.lat&&(k!=null&&k.lng)?"gps":l.address.trim()?"manual":null,ae=()=>{const s=t.reduce((n,M)=>{const O=o[M.productId];return n+((O==null?void 0:O.price)||0)*M.quantity},0),d=r==="delivery"?20:0,c=(R==null?void 0:R.discountAmount)||0;return{subtotal:s,deliveryFee:d,discount:c,total:s+d-c,isOffline:!0,deliveryInfo:{isEstimated:!0}}},J=(s,d)=>{q(c=>({...c,[s]:d})),E[s]&&C(c=>({...c,[s]:null}))},ce=s=>{i(s),s==="pickup"?(U(null),z(null)):w(null),E.deliveryMethod&&C(d=>({...d,deliveryMethod:null}))},xe=s=>{w(s),E.branch&&C(d=>({...d,branch:null}))},me=()=>{if(!navigator.geolocation){z(g("errorGeolocationNotSupported")||"Geolocation not supported");return}D(!0),z(null),navigator.geolocation.getCurrentPosition(s=>{const d={lat:s.coords.latitude,lng:s.coords.longitude,accuracy:s.coords.accuracy};console.log("âœ… GPS Location obtained:",d),U(d);const c=`${s.coords.latitude.toFixed(6)}, ${s.coords.longitude.toFixed(6)}`,n=Math.round(s.coords.accuracy);J("address",u==="ar"?`Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ (${c}) - Ø§Ù„Ø¯Ù‚Ø©: ${n}Ù…`:`Current location (${c}) - Accuracy: ${n}m`),D(!1)},s=>{console.error("âŒ GPS error:",s),z({1:u==="ar"?"ØªÙ… Ø±ÙØ¶ Ø¥Ø°Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹":"Permission denied",2:u==="ar"?"Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªØ§Ø­":"Unavailable",3:u==="ar"?"Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ù‡Ù„Ø©":"Timeout"}[s.code]||(u==="ar"?"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹":"Location error")),D(!1)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})},ue=async()=>{const s=l.couponCode.trim().toUpperCase();if(s){Q(!0),L(null);try{const d=await H.validateCoupon(s,l.phone.replace(/\D/g,"")||"0000000000",(m==null?void 0:m.subtotal)||ae().subtotal);d.valid?(L("valid"),$(d.coupon),console.log("âœ… Coupon valid:",d.coupon)):(L("error"),$({error:d.message||"Invalid coupon"}))}catch(d){console.error("âŒ Coupon validation failed:",d),L("error"),$({error:d.message})}finally{Q(!1)}}},pe=()=>{J("couponCode",""),L(null),$(null)},he=async()=>{const s=Oe({formData:l,deliveryMethod:r,selectedBranch:N});if(!s.valid){C(s.errors);return}ee(!0),W(null);try{const d={items:t.map(f=>({productId:f.productId||f.id,quantity:f.quantity})),customer:{name:l.name.trim(),phone:l.phone.replace(/\D/g,""),...r==="delivery"&&{address:l.address.trim()},...l.notes&&{notes:l.notes.trim()}},customerPhone:l.phone.replace(/\D/g,""),deliveryMethod:r,...r==="pickup"&&{branch:N},...k&&{location:k},...Z()&&{addressInputType:Z()},...l.address.trim()&&r==="delivery"&&{deliveryAddress:l.address.trim()},...l.couponCode&&A==="valid"&&{couponCode:l.couponCode.trim()}};console.log("ğŸ“¤ Submitting order:",d);const c=await H.submitOrder(d);console.log("âœ… Order submitted successfully:",c);const n=c.calculatedPrices||m,M=c.orderId||c.id,O=c.eta||c.etaAr||(u==="ar"?"30-45 Ø¯Ù‚ÙŠÙ‚Ø©":"30-45 minutes"),ge={id:M,status:"confirmed",createdAt:new Date().toISOString(),items:((n==null?void 0:n.items)||t).map(f=>{const S=o[f.productId];return{productId:f.productId||f.id,name:S?u==="ar"?S.name:S.nameEn:`Product ${f.productId}`,quantity:f.quantity,price:f.price||(S==null?void 0:S.price)||0,total:f.total||(f.price||(S==null?void 0:S.price)||0)*f.quantity}}),totals:{subtotal:(n==null?void 0:n.subtotal)||(m==null?void 0:m.subtotal)||0,deliveryFee:(n==null?void 0:n.deliveryFee)||(m==null?void 0:m.deliveryFee)||0,discount:(n==null?void 0:n.discount)||(m==null?void 0:m.discount)||0,total:(n==null?void 0:n.total)||(m==null?void 0:m.total)||0},deliveryMethod:r,branch:N,customer:{name:l.name.trim(),phone:l.phone.replace(/\D/g,""),address:l.address.trim()||null},eta:O,couponCode:l.couponCode||null,deliveryInfo:(n==null?void 0:n.deliveryInfo)||(m==null?void 0:m.deliveryInfo)||{}};ke.addOrder(ge)?(console.log("âœ… Order saved locally:",M),window.dispatchEvent(new CustomEvent("ordersUpdated",{detail:{orderId:M,action:"added"}}))):console.warn("âš ï¸ Failed to save order locally (non-critical)"),j(),x&&x(M),ye()}catch(d){console.error("âŒ Order submission failed:",d),W(d.message||"Failed to submit order")}finally{ee(!1)}},ye=()=>{q({name:"",phone:"",address:"",notes:"",couponCode:""}),i(null),w(null),U(null),G(null),C({}),L(null),$(null)};return a?e.jsx("div",{className:"fixed inset-0 bg-gray-900/80 backdrop-blur-md z-[9100] flex items-center justify-center p-5 overflow-y-auto",onClick:()=>!P&&h(),children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-3xl p-8 max-w-[650px] w-full max-h-[90vh] overflow-y-auto shadow-2xl relative",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{className:"absolute top-4 right-4 bg-gray-100 dark:bg-gray-700 w-10 h-10 rounded-full flex items-center justify-center hover:bg-red-500 hover:text-white transition-all",onClick:h,disabled:P,children:e.jsx(ve,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center mb-7",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-primary to-primary-dark rounded-full flex items-center justify-center mx-auto mb-4 text-white shadow-lg",children:e.jsx(Ne,{className:"w-8 h-8"})}),e.jsx("h3",{className:"text-[26px] font-black text-gray-800 dark:text-gray-100 mb-2",children:g("checkoutTitle")||"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨"}),e.jsx("p",{className:"text-base text-gray-600 dark:text-gray-400",children:g("checkoutSubtitle")||"Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… ÙˆØ£ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ"})]}),e.jsx(Ae,{deliveryMethod:r,selectedBranch:N,branches:I,branchesLoading:b,errors:E,onDeliveryMethodChange:ce,onBranchSelect:xe}),e.jsx($e,{formData:l,deliveryMethod:r,errors:E,userLocation:k,locationLoading:le,locationError:ne,couponStatus:A,couponData:R,couponLoading:se,onInputChange:J,onRequestLocation:me,onApplyCoupon:ue,onRemoveCoupon:pe}),r&&e.jsx(qe,{cart:t,products:o,productsLoading:!1,prices:m,pricesLoading:de,pricesError:oe,deliveryMethod:r}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{className:"py-4 px-6 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 rounded-2xl font-bold hover:bg-gray-300 dark:hover:bg-gray-600 transition-all",onClick:h,disabled:P,children:g("cancel")||"Ø¥Ù„ØºØ§Ø¡"}),e.jsx("button",{className:"flex-1 py-4 px-6 bg-gradient-to-r from-primary to-primary-dark text-white rounded-2xl font-bold shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:he,disabled:P||!r||r==="pickup"&&!N,children:P?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:u==="ar"?"Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...":"Submitting..."})]}):e.jsx("span",{children:g("confirmOrder")||"ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨"})})]}),te&&e.jsxs("div",{className:"mt-4 p-4 bg-red-50 border-2 border-red-500 rounded-xl text-red-600 text-sm",children:[e.jsx("div",{className:"font-bold mb-1",children:u==="ar"?"ÙØ´Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨":"Order Failed"}),e.jsx("div",{children:te})]})]})}):null};export{Xe as default};
